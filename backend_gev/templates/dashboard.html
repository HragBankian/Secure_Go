{% extends "base.html" %}

{% block title %}Dashboard - SecureGo{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .dashboard-header h2 {
        margin: 0;
        color: var(--primary);
    }
    
    .dashboard-actions {
        display: flex;
        gap: 10px;
    }
    
    .dashboard-actions button {
        background-color: var(--light);
        color: var(--dark);
    }
    
    .dashboard-actions button:hover {
        background-color: #dfe6e9;
    }
    
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: 20px;
        text-align: center;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }
    
    .stat-card:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
    }
    
    .stat-card:nth-child(1):before {
        background-color: var(--accent);
    }
    
    .stat-card:nth-child(2):before {
        background-color: var(--danger);
    }
    
    .stat-card:nth-child(3):before {
        background-color: var(--success);
    }
    
    .stat-card:nth-child(4):before {
        background-color: var(--warning);
    }
    
    .stat-card h3 {
        margin-top: 0;
        color: var(--secondary);
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary);
        margin: 15px 0;
    }
    
    .stat-trend {
        font-size: 0.8rem;
        color: var(--success);
    }
    
    .trend-up {
        color: var(--success);
    }
    
    .trend-down {
        color: var(--danger);
    }
    
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    @media (max-width: 768px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .chart-container {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: 20px;
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--light);
    }
    
    .chart-container h3 {
        margin: 0;
        color: var(--secondary);
        font-size: 1.1rem;
    }
    
    .chart-actions {
        display: flex;
        gap: 10px;
    }
    
    .chart-actions button {
        background: none;
        border: none;
        color: var(--secondary);
        cursor: pointer;
        padding: 5px;
        font-size: 0.8rem;
    }
    
    .chart-actions button:hover {
        color: var(--accent);
    }
    
    .placeholder-message {
        text-align: center;
        padding: 50px 0;
        color: var(--secondary);
        font-style: italic;
    }
    
    .recent-detections {
        margin-top: 30px;
    }
    
    .detection-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--light);
    }
    
    .detection-info {
        display: flex;
        align-items: center;
    }
    
    .detection-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        color: white;
    }
    
    .detection-icon.spam {
        background-color: var(--danger);
    }
    
    .detection-icon.ham {
        background-color: var(--success);
    }
    
    .detection-meta {
        display: flex;
        flex-direction: column;
    }
    
    .detection-subject {
        font-weight: 600;
        color: var(--dark);
    }
    
    .detection-time {
        font-size: 0.8rem;
        color: var(--secondary);
    }
    
    .detection-result {
        font-weight: 600;
    }
    
    .detection-result.spam {
        color: var(--danger);
    }
    
    .detection-result.ham {
        color: var(--success);
    }
    
    /* NSFW Detection Styles */
    .tag {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .tag-nsfw {
        background-color: #ffebee;
        color: #d32f2f;
    }
    
    .tag-safe {
        background-color: #e8f5e9;
        color: #388e3c;
    }
    
    .tag-warning {
        background-color: #fff8e1;
        color: #ffa000;
    }
    
    .nsfw-sites-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .nsfw-sites-table th, 
    .nsfw-sites-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--light);
    }
    
    .nsfw-sites-table th {
        background-color: #f9f9f9;
        font-weight: 600;
        color: var(--dark);
    }
    
    .nsfw-sites-table tr:hover {
        background-color: #f5f5f5;
    }
    
    /* Settings Panel Styles */
    .settings-panel {
        margin-top: 30px;
    }
    
    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
        gap: 20px;
    }
    
    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--light);
    }
    
    .setting-info {
        max-width: 80%;
    }
    
    .setting-title {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 5px;
    }
    
    .setting-description {
        color: var(--secondary);
        font-size: 0.9rem;
    }
    
    /* Toggle Switch Styles */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }
    
    .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    input:checked + .slider {
        background-color: var(--accent);
    }
    
    input:focus + .slider {
        box-shadow: 0 0 1px var(--accent);
    }
    
    input:checked + .slider:before {
        transform: translateX(26px);
    }
    
    .section-title {
        color: var(--primary);
        margin: 2rem 0 1rem;
        font-size: 1.5rem;
        font-weight: 600;
        border-bottom: 2px solid var(--light);
        padding-bottom: 0.5rem;
    }
    
    /* Trusted Domains Styles */
    .trusted-domains-list {
        margin: 15px 0;
        max-height: 200px;
        overflow-y: auto;
    }
    
    .trusted-domain-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background-color: #f5f5f5;
        border-radius: 4px;
        margin-bottom: 8px;
    }
    
    .btn-remove {
        background: none;
        border: none;
        color: var(--danger);
        cursor: pointer;
        padding: 2px 5px;
        font-size: 0.9rem;
    }
    
    .add-domain-form {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    
    .add-domain-form input {
        flex-grow: 1;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h2>Email Security Dashboard</h2>
    <div class="dashboard-actions">
        <button id="refresh-btn"><i class="fas fa-sync-alt"></i> Refresh Data</button>
        <button id="export-btn"><i class="fas fa-download"></i> Export Report</button>
    </div>
</div>

<div class="stats-container">
    <div class="stat-card">
        <h3>Emails Scanned</h3>
        <div class="stat-value">{{ stats.total_emails|default('2,458') }}</div>
        <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 12% from last month</div>
    </div>
    
    <div class="stat-card">
        <h3>Phishing Detected</h3>
        <div class="stat-value">{{ stats.phishing_emails|default('568') }}</div>
        <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 8% from last month</div>
    </div>
    
    <div class="stat-card">
        <h3>Safe Emails</h3>
        <div class="stat-value">{{ stats.legitimate_emails|default('1,890') }}</div>
        <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 15% from last month</div>
    </div>
    
    <div class="stat-card">
        <h3>Detection Rate</h3>
        <div class="stat-value">{{ stats.detection_rate|default('98.7%') }}</div>
        <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 2.1% from last month</div>
    </div>
</div>

<!-- NSFW Protection Stats Row -->
<h2 class="section-title">NSFW Protection</h2>
<div class="stats-container">
    <div class="stat-card">
        <h3>Sites Analyzed</h3>
        <div class="stat-value" id="nsfw-analyzed">834</div>
        <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 15% from last month</div>
    </div>
    
    <div class="stat-card">
        <h3>NSFW Sites Detected</h3>
        <div class="stat-value warning-value" id="nsfw-detected">68</div>
        <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 5% from last month</div>
    </div>
    
    <div class="stat-card">
        <h3>NSFW Detection Rate</h3>
        <div class="stat-value" id="nsfw-rate">8.2%</div>
        <div class="stat-trend trend-down"><i class="fas fa-arrow-down"></i> 2% from last month</div>
    </div>
    
    <div class="stat-card">
        <h3>NSFW Warnings Blocked</h3>
        <div class="stat-value success-value" id="nsfw-blocked">54</div>
        <div class="stat-trend trend-up"><i class="fas fa-arrow-up"></i> 18% from last month</div>
    </div>
</div>

<div class="card recent-detections">
    <div class="chart-header">
        <h3>Recent Email Detections</h3>
        <div class="chart-actions">
            <button><i class="fas fa-filter"></i> Filter</button>
            <button><i class="fas fa-ellipsis-h"></i></button>
        </div>
    </div>
    
    <div id="recent-items">
        <div class="detection-item">
            <div class="detection-info">
                <div class="detection-icon spam">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="detection-meta">
                    <div class="detection-subject">Account Security Alert</div>
                    <div class="detection-time">Today, 10:42 AM</div>
                </div>
            </div>
            <div class="detection-result spam">Phishing</div>
        </div>
        
        <div class="detection-item">
            <div class="detection-info">
                <div class="detection-icon ham">
                    <i class="fas fa-check"></i>
                </div>
                <div class="detection-meta">
                    <div class="detection-subject">Team Meeting Tomorrow</div>
                    <div class="detection-time">Today, 09:15 AM</div>
                </div>
            </div>
            <div class="detection-result ham">Legitimate</div>
        </div>
        
        <div class="detection-item">
            <div class="detection-info">
                <div class="detection-icon spam">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="detection-meta">
                    <div class="detection-subject">Urgent: Payment Required</div>
                    <div class="detection-time">Yesterday, 7:30 PM</div>
                </div>
            </div>
            <div class="detection-result spam">Phishing</div>
        </div>
    </div>
</div>

<!-- NSFW Sites Panel -->
<div class="card recent-detections">
    <div class="chart-header">
        <h3>NSFW Sites Detected</h3>
        <div class="chart-actions">
            <button id="nsfw-refresh-btn"><i class="fas fa-sync-alt"></i> Refresh</button>
            <button><i class="fas fa-filter"></i> Filter</button>
        </div>
    </div>
    
    <div id="nsfw-sites-container">
        <table class="nsfw-sites-table">
            <thead>
                <tr>
                    <th>Domain</th>
                    <th>First Visit</th>
                    <th>Last Visit</th>
                    <th>Visits</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="nsfw-sites-tbody">
                <tr>
                    <td>example-nsfw-site1.com</td>
                    <td>2024-05-02</td>
                    <td>2024-05-12</td>
                    <td>8</td>
                    <td><span class="tag tag-nsfw">NSFW</span></td>
                </tr>
                <tr>
                    <td>explicit-content-domain.net</td>
                    <td>2024-05-05</td>
                    <td>2024-05-10</td>
                    <td>3</td>
                    <td><span class="tag tag-nsfw">NSFW</span></td>
                </tr>
                <tr>
                    <td>adult-site-example.org</td>
                    <td>2024-04-28</td>
                    <td>2024-05-08</td>
                    <td>5</td>
                    <td><span class="tag tag-nsfw">NSFW</span></td>
                </tr>
            </tbody>
        </table>
        <div id="nsfw-sites-empty" class="empty-state" style="display: none;">
            <p>No NSFW sites detected yet.</p>
        </div>
        <div class="pagination" id="nsfw-pagination"></div>
    </div>
</div>

<!-- NSFW Activity Log Panel -->
<div class="card recent-detections">
    <div class="chart-header">
        <h3>NSFW Activity Log</h3>
        <div class="chart-actions">
            <button id="activity-refresh-btn"><i class="fas fa-sync-alt"></i> Refresh</button>
            <button><i class="fas fa-filter"></i> Filter</button>
        </div>
    </div>
    
    <div id="activity-container">
        <table class="nsfw-sites-table">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Domain</th>
                    <th>Action</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="activity-tbody">
                <tr>
                    <td>2024-05-12 14:23:45</td>
                    <td>example-nsfw-site1.com</td>
                    <td>Warning Displayed</td>
                    <td><span class="tag tag-warning">Warning</span></td>
                </tr>
                <tr>
                    <td>2024-05-12 13:10:22</td>
                    <td>explicit-content-domain.net</td>
                    <td>Access Blocked</td>
                    <td><span class="tag tag-nsfw">Blocked</span></td>
                </tr>
                <tr>
                    <td>2024-05-11 18:45:30</td>
                    <td>adult-site-example.org</td>
                    <td>User Proceeded</td>
                    <td><span class="tag tag-warning">Allowed</span></td>
                </tr>
                <tr>
                    <td>2024-05-10 09:12:15</td>
                    <td>safe-website.com</td>
                    <td>Analysis Completed</td>
                    <td><span class="tag tag-safe">Safe</span></td>
                </tr>
            </tbody>
        </table>
        <div id="activity-empty" class="empty-state" style="display: none;">
            <p>No NSFW activity recorded yet.</p>
        </div>
        <div class="pagination" id="activity-pagination"></div>
    </div>
</div>

<!-- NSFW Protection Settings -->
<div class="card settings-panel">
    <div class="chart-header">
        <h3>NSFW Protection Settings</h3>
        <div class="chart-actions">
            <button id="save-settings-btn" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
        </div>
    </div>
    
    <div class="settings-grid">
        <div class="panel">
            <h4>General Settings</h4>
            
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-title">Enable NSFW Protection</div>
                    <div class="setting-description">Detect and block NSFW content across websites</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="nsfw-protection-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-title">Show Warning Page</div>
                    <div class="setting-description">Display a warning before accessing NSFW content</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="warning-page-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-title">Auto-Block NSFW Content</div>
                    <div class="setting-description">Automatically block access to detected NSFW content</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="auto-block-toggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="panel">
            <h4>Detection Settings</h4>
            
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-title">Detection Sensitivity</div>
                    <div class="setting-description">Adjust how sensitive the NSFW detection should be</div>
                </div>
                <select id="sensitivity-select" class="form-control">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-title">Scan Images</div>
                    <div class="setting-description">Analyze images for NSFW content</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="scan-images-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-title">Scan Text</div>
                    <div class="setting-description">Analyze page text for explicit content</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="scan-text-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- Add trusted domains setting -->
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-title">Trusted Domains</div>
                    <div class="setting-description">Always ignore NSFW detection on these domains</div>
                </div>
                <button id="manage-trusted-btn" class="btn"><i class="fas fa-cog"></i> Manage</button>
            </div>
        </div>
    </div>
    
    <!-- Trusted Domains List -->
    <div class="panel" id="trusted-domains-panel" style="margin-top: 20px;">
        <h4>Trusted Domains List</h4>
        <p>These domains will be ignored by the NSFW detection system:</p>
        
        <div class="trusted-domains-list">
            <div class="trusted-domain-item">
                <span>securego.com</span>
                <button class="btn-remove"><i class="fas fa-times"></i></button>
            </div>
            <div class="trusted-domain-item">
                <span>mail.securego.com</span>
                <button class="btn-remove"><i class="fas fa-times"></i></button>
            </div>
            <div class="trusted-domain-item">
                <span>dashboard.securego.com</span>
                <button class="btn-remove"><i class="fas fa-times"></i></button>
            </div>
        </div>
        
        <div class="add-domain-form">
            <input type="text" id="new-domain-input" placeholder="Enter domain to whitelist..." class="form-control">
            <button id="add-domain-btn" class="btn"><i class="fas fa-plus"></i> Add Domain</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Check if coming from extension
        const isFromExtension = new URLSearchParams(window.location.search).get('source') === 'extension';

        // NSFW sections to hide/show based on source
        const nsfwSections = [
            document.querySelector('.section-title'),  // NSFW Protection title
            document.querySelectorAll('.stats-container')[1],  // NSFW stats container
            document.querySelectorAll('.card.recent-detections')[1],  // NSFW Sites panel
            document.querySelectorAll('.card.recent-detections')[2],  // NSFW Activity Log
            document.querySelector('.card.settings-panel')  // NSFW Settings
        ];

        // Always show NSFW sections - removing the conditional check
        /*
        if (!isFromExtension) {
            nsfwSections.forEach(section => {
                if (section) section.style.display = 'none';
            });
        }
        */
        
        // Make sure NSFW sections are visible
        nsfwSections.forEach(section => {
            if (section) section.style.display = '';
        });

        // Load NSFW data regardless of source
        loadNsfwData();

        // Original dashboard code
        // Sample data for charts
        const setupCharts = () => {
            if (!window.Chart) {
                console.log('Chart.js not loaded');
                return;
            }
            
            // Daily chart
            const dailyCtx = document.getElementById('daily-chart');
            if (dailyCtx) {
                new Chart(dailyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Phishing Attempts',
                            data: [65, 59, 80, 81, 56, 55, 72],
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Safe Emails',
                            data: [28, 48, 40, 19, 86, 27, 90],
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                });
            }
            
            // Types chart
            const typesCtx = document.getElementById('types-chart');
            if (typesCtx) {
                new Chart(typesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Credential Phishing', 'Malware', 'Spear Phishing', 'BEC', 'Other'],
                        datasets: [{
                            data: [35, 20, 15, 25, 5],
                            backgroundColor: [
                                '#e74c3c',
                                '#f39c12',
                                '#3498db',
                                '#9b59b6',
                                '#95a5a6'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            }
                        }
                    }
                });
            }
            
            // Keywords chart
            const keywordsCtx = document.getElementById('keywords-chart');
            if (keywordsCtx) {
                new Chart(keywordsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Account', 'Password', 'Verify', 'Urgent', 'Payment', 'Link'],
                        datasets: [{
                            label: 'Frequency',
                            data: [65, 59, 80, 81, 56, 40],
                            backgroundColor: '#3498db'
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Accuracy chart
            const accuracyCtx = document.getElementById('accuracy-chart');
            if (accuracyCtx) {
                new Chart(accuracyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Detection Accuracy',
                            data: [92, 93, 94, 94.5, 96, 98.7],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                min: 90,
                                max: 100
                            }
                        }
                    }
                });
            }
        };
        
        // Initialize charts
        setTimeout(setupCharts, 100);
        
        // Buttons functionality
        document.getElementById('refresh-btn').addEventListener('click', function() {
            this.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Refreshing...';
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Data';
            }, 1500);
        });
        
        document.getElementById('export-btn').addEventListener('click', function() {
            alert('Report would be exported here.');
        });
        
        // Period selection for the first chart
        document.querySelectorAll('.chart-actions button[data-period]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all period buttons
                document.querySelectorAll('.chart-actions button[data-period]').forEach(b => {
                    b.classList.remove('active');
                });
                // Add active class to clicked button
                this.classList.add('active');
                
                // In a real application, this would update the chart with new data
                console.log(`Showing data for period: ${this.dataset.period}`);
            });
        });
        
        // NSFW Data Handling - only execute if coming from extension
        if (isFromExtension) {
            loadNsfwData();
        }
        
        function loadNsfwData() {
            // In a real application, this would fetch data from the backend
            // For now, we're using the placeholder data already in the HTML
            
            // Mock function to simulate data loading from extension storage
            // In production, this would be replaced with actual API calls
            console.log("Loading NSFW data from extension storage...");
            
            // Simulate refresh functionality
            document.getElementById('nsfw-refresh-btn').addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Refreshing...';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    // Would update data here in production
                }, 1000);
            });
            
            // Simulate activity refresh functionality
            document.getElementById('activity-refresh-btn').addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Refreshing...';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                    // Would update data here in production
                }, 1000);
            });
            
            // Simulate save settings functionality
            document.getElementById('save-settings-btn').addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Saving...';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-save"></i> Save Changes';
                    showNotification('Settings saved successfully!');
                }, 1000);
            });
            
            // Toggle behavior for settings
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                toggle.addEventListener('change', function() {
                    const settingId = this.id;
                    const isEnabled = this.checked;
                    console.log(`Setting ${settingId} changed to ${isEnabled}`);
                    
                    // Special handling for dependencies
                    if (settingId === 'nsfw-protection-toggle' && !isEnabled) {
                        // If main protection is disabled, disable dependent features
                        document.getElementById('warning-page-toggle').disabled = true;
                        document.getElementById('auto-block-toggle').disabled = true;
                    } else if (settingId === 'nsfw-protection-toggle' && isEnabled) {
                        // If main protection is enabled, enable dependent features
                        document.getElementById('warning-page-toggle').disabled = false;
                        document.getElementById('auto-block-toggle').disabled = false;
                    }
                });
            });
            
            // Manage trusted domains
            const manageTrustedBtn = document.getElementById('manage-trusted-btn');
            const trustedDomainsPanel = document.getElementById('trusted-domains-panel');
            const addDomainBtn = document.getElementById('add-domain-btn');
            const newDomainInput = document.getElementById('new-domain-input');
            
            // Toggle trusted domains panel
            manageTrustedBtn.addEventListener('click', function() {
                trustedDomainsPanel.style.display = trustedDomainsPanel.style.display === 'none' || trustedDomainsPanel.style.display === '' ? 'block' : 'none';
            });
            
            // Initially hide the panel
            trustedDomainsPanel.style.display = 'none';
            
            // Add new domain
            addDomainBtn.addEventListener('click', function() {
                const domain = newDomainInput.value.trim();
                if (domain) {
                    addTrustedDomain(domain);
                    newDomainInput.value = '';
                }
            });
            
            // Add domain on Enter key
            newDomainInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const domain = newDomainInput.value.trim();
                    if (domain) {
                        addTrustedDomain(domain);
                        newDomainInput.value = '';
                    }
                }
            });
            
            // Set up remove buttons
            document.querySelectorAll('.btn-remove').forEach(btn => {
                btn.addEventListener('click', function() {
                    const domainItem = this.parentElement;
                    domainItem.remove();
                    showNotification('Domain removed from whitelist');
                });
            });
            
            // Function to add trusted domain
            function addTrustedDomain(domain) {
                const domainsList = document.querySelector('.trusted-domains-list');
                
                // Create new domain item
                const domainItem = document.createElement('div');
                domainItem.className = 'trusted-domain-item';
                
                // Domain text
                const domainText = document.createElement('span');
                domainText.textContent = domain;
                
                // Remove button
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn-remove';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                
                // Add remove event
                removeBtn.addEventListener('click', function() {
                    domainItem.remove();
                    showNotification('Domain removed from whitelist');
                });
                
                // Assemble and add to list
                domainItem.appendChild(domainText);
                domainItem.appendChild(removeBtn);
                domainsList.appendChild(domainItem);
                
                showNotification('Domain added to whitelist');
            }
        }
        
        // Simple notification function
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-check-circle"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Style the notification
            Object.assign(notification.style, {
                position: 'fixed',
                bottom: '20px',
                right: '20px',
                backgroundColor: '#4CAF50',
                color: 'white',
                padding: '10px 20px',
                borderRadius: '4px',
                boxShadow: '0 2px 10px rgba(0, 0, 0, 0.2)',
                zIndex: '1000',
                transform: 'translateY(100px)',
                transition: 'transform 0.3s ease-out'
            });
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
            }, 10);
            
            // Remove after delay
            setTimeout(() => {
                notification.style.transform = 'translateY(100px)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    });
</script>
{% endblock %} 